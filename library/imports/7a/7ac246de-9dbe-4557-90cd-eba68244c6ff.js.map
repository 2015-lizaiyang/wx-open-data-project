{"version":3,"sources":["../../../../assets/scripts/assets/scripts/game.js"],"names":["cc","Class","extends","Component","properties","prefab","Prefab","canvas","Node","start","_self","wx","onMessage","console","log","data","message","getUserInfo","openIdList","lang","success","res","userInfo","createUserBlock","fail","reject","user","node","createPrefab","addChild","setPosition","v2","height","nickName","nickname","avatarUrl","userName","getChildByName","getComponent","Label","userIcon","Sprite","string","loader","load","url","type","err","texture","error","spriteFrame","SpriteFrame","instantiate","parent","content"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACPC,WAASF,GAAGG,SADL;;AAGPC,cAAY;AACVC,YAAQL,GAAGM,MADD;AAEVC,YAAQP,GAAGQ;AAFD,GAHL;;AAQPC,OARO,mBAQC;AACN,QAAIC,QAAQ,IAAZ;;AAEAC,OAAGC,SAAH,CAAa,gBAAQ;AACnBC,cAAQC,GAAR,CAAY,UAAQC,KAAKC,OAAzB;AACAH,cAAQC,GAAR,CAAY,2BAA2BC,IAAvC;AACD,KAHD;;AAKA;AACAJ,OAAGM,WAAH,CAAe;AACbC,kBAAY,CAAC,YAAD,CADC;AAEbC,YAAM,OAFO;AAGbC,eAAS,iBAACC,GAAD,EAAS;AAChBR,gBAAQC,GAAR,CAAY,SAAZ,EAAuBO,IAAIN,IAA3B;AACA,YAAIO,WAAWD,IAAIN,IAAJ,CAAS,CAAT,CAAf;AACAL,cAAMa,eAAN,CAAsBD,QAAtB;AACD,OAPY;AAQbE,YAAM,cAACH,GAAD,EAAS;AACbI,eAAOJ,GAAP;AACD;AAVY,KAAf;;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,GA9CM;AAgDPE,iBAhDO,2BAgDSG,IAhDT,EAgDe;AACpB,QAAIC,OAAO,KAAKC,YAAL,EAAX;AACA,SAAKrB,MAAL,CAAYsB,QAAZ,CAAqBF,IAArB;AACAA,SAAKG,WAAL,CAAiB9B,GAAG+B,EAAH,CAAM,CAAN,EAAU,KAAKxB,MAAL,CAAYyB,MAAZ,GAAqB,CAAtB,GAA2BL,KAAKK,MAAL,GAAY,CAAhD,CAAjB;AACA;AACA,QAAIC,WAAWP,KAAKO,QAAL,GAAgBP,KAAKO,QAArB,GAAgCP,KAAKQ,QAApD;AACA,QAAIC,YAAYT,KAAKS,SAArB;;AAEA,QAAIC,WAAWT,KAAKU,cAAL,CAAoB,eAApB,EAAqCC,YAArC,CAAkDtC,GAAGuC,KAArD,CAAf;AACA,QAAIC,WAAWb,KAAKU,cAAL,CAAoB,iBAApB,EAAuCC,YAAvC,CAAoDtC,GAAGyC,MAAvD,CAAf;;AAEAL,aAASM,MAAT,GAAkBT,QAAlB;AACApB,YAAQC,GAAR,CAAYsB,QAAZ;AACAvB,YAAQC,GAAR,CAAYmB,WAAW,2BAAvB;AACAjC,OAAG2C,MAAH,CAAUC,IAAV,CAAe;AACbC,WAAKV,SADQ;AAEbW,YAAM;AAFO,KAAf,EAGG,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACnB,UAAID,GAAJ,EAASlC,QAAQoC,KAAR,CAAcF,GAAd;AACTP,eAASU,WAAT,GAAuB,IAAIlD,GAAGmD,WAAP,CAAmBH,OAAnB,CAAvB;AACD,KAND;AAOD,GArEM;AAuEPpB,cAvEO,0BAuEQ;AACb,QAAID,OAAO3B,GAAGoD,WAAH,CAAe,KAAK/C,MAApB,CAAX;AACAsB,SAAK0B,MAAL,GAAc,KAAKC,OAAnB;AACA,WAAO3B,IAAP;AACD;AA3EM,CAAT","file":"game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n  extends: cc.Component,\n\n  properties: {\n    prefab: cc.Prefab,\n    canvas: cc.Node\n  },\n\n  start() {\n    let _self = this;\n\n    wx.onMessage(data => {\n      console.log('-----'+data.message);\n      console.log(\"User info get success.\" + data);\n    });\n\n    // https://developers.weixin.qq.com/minigame/dev/document/open-api/data/wx.getUserInfo.html\n    wx.getUserInfo({\n      openIdList: ['selfOpenId'],\n      lang: 'zh_CN',\n      success: (res) => {\n        console.log('success', res.data);\n        let userInfo = res.data[0];\n        _self.createUserBlock(userInfo);\n      },\n      fail: (res) => {\n        reject(res);\n      }\n    });\n\n    // // https://developers.weixin.qq.com/minigame/dev/document/open-api/data/wx.getFriendCloudStorage.html\n    // wx.getFriendCloudStorage({\n    //   success: function (res) {\n    //     for (let i = 0; i < 6; i++) {\n    //       let friendInfo = res.data[i];\n    //       if (!friendInfo) {\n    //         _self.createPrefab();\n    //         continue;\n    //       }\n    //       _self.createUserBlock(friendInfo);\n    //     }\n    //   },\n    //   fail: function (res) {\n    //     console.error(res);\n    //   }\n    // });\n  },\n\n  createUserBlock(user) {\n    let node = this.createPrefab();\n    this.canvas.addChild(node);\n    node.setPosition(cc.v2(0, (this.canvas.height / 2) - node.height/2))\n    // getUserInfo will return the nickName, getFriendCloudStorage will return the nickname.\n    let nickName = user.nickName ? user.nickName : user.nickname;\n    let avatarUrl = user.avatarUrl;\n\n    let userName = node.getChildByName('userNameLabel').getComponent(cc.Label);\n    let userIcon = node.getChildByName('userImageSprite').getComponent(cc.Sprite);\n\n    userName.string = nickName;\n    console.log(userName)\n    console.log(nickName + '\\'s info has been getten.');\n    cc.loader.load({\n      url: avatarUrl,\n      type: 'png'\n    }, (err, texture) => {\n      if (err) console.error(err);\n      userIcon.spriteFrame = new cc.SpriteFrame(texture);\n    });\n  },\n\n  createPrefab() {\n    let node = cc.instantiate(this.prefab);\n    node.parent = this.content;\n    return node;\n  }\n\n});\n"]}